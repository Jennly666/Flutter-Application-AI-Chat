# AIChatFlutter — кроссплатформенный офлайн-кэшируемый AI-чат

AIChatFlutter — это современное локальное приложение на **Flutter**, которое работает как удобный AI-чат с несколькими моделями, поддерживает работу с API-ключами **OpenRouter** и **VSEGPT**, имеет локальную базу данных SQLite, встроенную аналитику и защиту входа.

Приложение работает на:

* **macOS**
* **Windows**
* **Linux**
* **Android**
* **iOS**
* **Web**

## Основные возможности

### 1. Cистема аутентификации (OpenRouter + VSEGPT)

При первом запуске:

1. Пользователь вводит API-ключ:

   * `sk-or-v1-...` — OpenRouter
   * `sk-or-vv-...` — VSEGPT
2. Ключ автоматически определяется → выполняется проверка на валидность.
3. Генерируется **4-значный PIN-код**, который показывается пользователю.
4. Ключ + хеш PIN сохраняются в локальной базе данных.

При следующих входах:

* Нужно ввести PIN.
* В случае неправильного PIN — показывается ошибка.
* Можно сбросить ключ → ввести новый API-ключ.

### 2. Полная поддержка моделей OpenRouter и VSEGPT

* Автоматическая загрузка списка моделей.
* Автоматический расчёт цены токенов.
* Поддержка бесплатных моделей и нулевого баланса.
* Автоматическое обновление баланса после запроса.

### 3. Локальная база данных SQLite (+ FFI)

Приложение использует SQLite для:

* хранения истории сообщений
* хранения статистики токенов
* хранения стоимости запросов
* хранения API-ключа и хеша PIN

Поддерживается на всех платформах (desktop + mobile).

### 4. Встроенная аналитика

Приложение собирает:

* время ответа моделей
* длину сообщений
* количество токенов
* эффективность моделей
* статистику по сессии
* использование по моделям

Доступно через меню → **“Аналитика”**.

### 5. Экспорт истории

Доступные форматы:

1. **JSON** — экспорт всей истории чата
2. **TXT** — полный debug-лог + сообщения

Файлы сохраняются в `ApplicationDocumentsDirectory`.

### 6. Управление историей

* Очистка истории сообщений
* Очистка логов
* Сброс API-ключа
* Сброс PIN

### 7. Современный UI

* тёмная тема
* красивые пузырьки сообщений
* копирование текста
* отображение статистики использования токенов
* выпадающий список моделей
* удобная панель действий

---

# Установка и запуск

## 1. Установка Flutter

```bash
flutter --version
```

Если Flutter не установлен:
[https://flutter.dev/docs/get-started/install](https://flutter.dev/docs/get-started/install)

## 2. Установка зависимостей

```bash
flutter pub get
```

## 3. macOS / Windows / Linux

Запуск:

```bash
flutter run -d macos
```

или

```bash
flutter run
```

---

# Структура проекта

```
lib/
 ├── api/
 │    └── openrouter_client.dart      # API-клиент (OpenRouter/VSEGPT)
 ├── models/
 │    ├── message.dart                # Модель сообщения
 │    ├── auth_info.dart              # Модель API-ключа + PIN
 ├── providers/
 │    └── chat_provider.dart          # Основная логика чата
 ├── screens/
 │    ├── chat_screen.dart            # Главный экран чата
 │    ├── api_key_setup_screen.dart   # Экран ввода API ключа
 │    └── pin_login_screen.dart       # Экран ввода PIN
 ├── services/
 │    ├── auth_service.dart           # Аутентификация + PIN
 │    ├── database_service.dart       # SQLite база данных
 │    └── analytics_service.dart      # Статистика и аналитика
 └── main.dart                        # Точка входа
```

---

# Аутентификация

## Поддерживаемые ключи:

### OpenRouter

```
sk-or-v1-123456789...
```

### VSEGPT

```
sk-or-vv-xxxxxxxx...
```

## Как работает проверка ключа?

* Если API отвечает **401/403 → ключ неверный**
* Любая другая ошибка (500, сеть, формат JSON) не мешает:

  * ключ считается валидным
  * приложение продолжает работу

Это позволяет:

* Принимать бесплатные/нулевые ключи
* Работать даже при временных проблемах на API
* Не блокировать пользователя из-за сети

---

# Возможные команды

```
flutter clean
flutter pub get
flutter pub run build_runner build
flutter run -d macos
```

---

# API

### Приложение делает запросы:

#### OpenRouter:

`GET https://openrouter.ai/api/v1/key`

#### VSEGPT:

`GET https://api.vsetgpt.ru/v1/user/balance`

---

# Планы развития

* Многосессионность
* Фавориты / закреплённые сообщения
* Местный LLM через Ollama
* Синхронизация с облаком
* Темы оформления
* Undo/Redo для сообщений
